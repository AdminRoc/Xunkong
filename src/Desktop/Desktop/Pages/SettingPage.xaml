<Page x:Class="Xunkong.Desktop.Pages.SettingPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:cc="using:CommunityToolkit.WinUI.UI.Controls"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="using:Xunkong.Desktop.Pages"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:models="using:Xunkong.Desktop.Models"
      xmlns:ui="using:CommunityToolkit.WinUI.UI"
      xmlns:viewmodels="using:Xunkong.Desktop.ViewModels"
      xmlns:xcx="using:Xunkong.Core.XunkongApi"
      d:DataContext="{x:Bind viewmodels:SettingViewModel}"
      x:DefaultBindMode="OneWay"
      Background="{StaticResource CustomPageBackgroundBrush}"
      mc:Ignorable="d">



    <Grid RowSpacing="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MaxWidth="1200" />
            <ColumnDefinition />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>


        <TextBlock Margin="48,24,0,0"
                   Style="{StaticResource TitleTextBlockStyle}"
                   Text="设置" />

        <ScrollViewer Grid.Row="1" Grid.ColumnSpan="2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition MaxWidth="1200" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Margin="48,0,48,0" Spacing="16">
                    <!--  关于  -->
                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="关于" />
                    <!--<Grid Padding="16,12,16,12"
                          Background="{StaticResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{StaticResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1"
                          ColumnSpacing="16"
                          CornerRadius="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <SymbolIcon Grid.Column="0" Symbol="Refresh" />
                        <TextBlock Grid.Column="1" VerticalAlignment="Center">
                            <Run Text="版本" />
                            <LineBreak />
                            <Run FontSize="12"
                                 Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                 Text="{x:Bind AppVersion}" />
                        </TextBlock>
                        <Button Grid.Column="2" Content="检查更新" />
                    </Grid>-->
                    <!--  关于  -->
                    <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                        <Expander.Header>
                            <Grid>
                                <StackPanel Padding="0,12,0,12"
                                            Orientation="Horizontal"
                                            Spacing="16">
                                    <SymbolIcon Symbol="Refresh" />
                                    <TextBlock>
                                        <Run Text="{x:Bind vm.AppName}" />
                                        <LineBreak />
                                        <Run FontSize="12"
                                             Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                             Text="{x:Bind vm.AppVersion}" />
                                    </TextBlock>
                                </StackPanel>
                                <Button HorizontalAlignment="Right"
                                        Command="{x:Bind vm.CheckUpdateCommand}"
                                        Content="检查更新" />
                            </Grid>
                        </Expander.Header>
                        <Expander.Content>
                            <StackPanel Margin="0,-16,44,-16">
                                <Grid>
                                    <StackPanel Padding="0,12,0,12"
                                                HorizontalAlignment="Left"
                                                Orientation="Horizontal"
                                                Spacing="16">
                                        <!--<SymbolIcon Symbol="Refresh" />-->
                                        <Border Width="20" />
                                        <TextBlock>
                                            <Run Text="更新通道" />
                                            <LineBreak />
                                            <Run FontSize="12"
                                                 Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                                 Text="可以选择稳定版、预览版、开发版，但只能从低版本升级至高版本" />
                                        </TextBlock>
                                    </StackPanel>
                                    <ComboBox HorizontalAlignment="Right"
                                              VerticalAlignment="Center"
                                              ItemsSource="{x:Bind vm.ChannelTypeList}"
                                              SelectedItem="{x:Bind vm.SelectedChannel, Mode=TwoWay}">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate x:DataType="xcx:ChannelType">
                                                <TextBlock Text="{x:Bind Converter={StaticResource EnumToDescriptionOrStringConverter}}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>
                        </Expander.Content>
                    </Expander>

                    <!--  应用模式  -->
                    <Grid Padding="16,12,60,12"
                          Background="{StaticResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{StaticResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1"
                          ColumnSpacing="16"
                          CornerRadius="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Path Width="20"
                              Data="M511.728 0c-144.592 4-265.024 54.128-361.312 150.4C54.144 246.704 4 367.152 0 511.744c0 45.296 7.328 88.272 21.984 128.928 14.656 40.64 35.824 76.624 63.472 107.936 27.648 31.312 59.296 55.312 94.944 71.968 35.648 16.64 73.632 24.976 113.936 24.976 40.32 0 79.968-8.992 118.944-26.976 38.976-18 76.128-44.64 111.44-79.968l2-1.984c65.296-81.296 133.6-121.6 204.896-120.944 23.312 0 45.632 3.168 66.96 9.504 21.328 6.32 41.312 13.152 59.968 20.48a435.68 435.68 0 0 0 42.48 14.992c13.664 4 26.48 6 38.48 6 39.968-3.328 64.464-23.328 73.456-59.968 8.992-36.64 12.496-68.304 10.496-94.944-4-144.592-54.144-265.04-150.416-361.312-96.288-96.288-216.72-146.432-361.312-150.416z m427.776 602.672c-6.672 0-15.168-1.664-25.488-4.992a607.584 607.584 0 0 1-33.488-12c-19.984-8-42.48-15.488-67.456-22.48-24.992-7.008-52.144-10.832-81.456-11.504-91.296-0.656-175.904 46.976-253.872 142.928-28.64 28.64-58.464 50.304-89.44 64.96-30.992 14.656-62.48 22-94.464 22-30.64 0-59.632-6.496-86.944-19.504-27.328-12.992-51.984-31.968-73.968-56.96s-38.976-54.144-50.976-87.456c-12-33.312-17.984-68.64-17.984-105.936 3.328-126.608 47.136-232.048 131.424-316.336 84.288-84.288 189.744-128.096 316.336-131.44 126.608 3.344 232.048 47.152 316.32 131.44 84.304 84.288 128.112 189.728 131.44 316.32 0 16-1.168 34.656-3.488 55.984-2.336 21.312-7.84 32.976-16.496 34.976z m-202.88-182.896c0 17.984 6.144 32.976 18.48 44.96 12.32 12 27.488 18 45.472 18s32.976-6 44.976-17.984c12-12 17.984-26.992 17.984-44.976 0-18-5.984-32.992-17.984-44.976-12-12-26.992-18-44.976-18-17.984 0-33.152 6-45.472 18s-18.496 26.976-18.496 44.96z m-343.84-202.896c0.672 18.656 7.008 33.984 18.992 45.968 12 12 26.992 18 44.976 18 18 0 32.992-6 44.976-18 12-12 18-27.152 18-45.472s-6-33.488-18-45.472c-12-12-26.976-18-44.96-18-18 0-32.992 6-44.992 18s-18.32 26.976-18.976 44.96z m215.888 26.976c0 18 6.176 32.992 18.496 44.976 12.32 12 27.488 18 45.472 18 18 0 32.992-6 44.976-18 12-12 18-26.976 18-44.96 0-18-6-32.992-18-44.992s-26.976-17.984-44.96-17.984c-18 0-33.168 6-45.488 17.984-12.32 12-18.496 26.992-18.496 44.976zM226.88 355.808c0.672 17.984 6.992 32.976 18.992 44.96 12 12 27.152 18 45.472 18s33.488-6 45.472-17.984c12-12 18-26.992 18-44.976 0-18-6-32.992-18-44.976-12-12-27.152-18-45.472-18s-33.472 6-45.472 18-18.32 26.976-18.992 44.96z m-44.96 246.864c0.64 27.312 10.144 49.968 28.48 67.968 18.32 17.984 40.96 26.976 67.952 26.976 26.992 0 49.472-8.992 67.472-26.976 17.984-18 26.976-40.64 26.976-67.968 0-27.312-8.992-49.968-26.976-67.968-18-17.984-40.48-26.976-67.472-26.976-26.976 0-49.632 8.992-67.968 26.976-18.32 18-27.808 40.64-28.48 67.968z"
                              Fill="{StaticResource TextFillColorPrimaryBrush}"
                              Stretch="Uniform" />
                        <TextBlock Grid.Column="1" VerticalAlignment="Center">
                            <Run Text="应用主题" />
                            <LineBreak />
                            <Run FontSize="12"
                                 Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                 Text="修改后需要重启应用才能生效" />
                        </TextBlock>
                        <ComboBox Grid.Column="2" SelectedIndex="{x:Bind vm.SelectedThemeIndex, Mode=TwoWay}">
                            <ComboBoxItem Content="跟随系统" />
                            <ComboBoxItem Content="浅色主题" />
                            <ComboBoxItem Content="深色主题" />
                        </ComboBox>
                    </Grid>

                    <!--  小工具  -->
                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="小工具" />
                    <Expander Name="_Expander_WebTool"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Stretch"
                              Collapsed="_Expander_WebTool_Collapsed">
                        <Expander.Header>
                            <StackPanel Padding="0,12,0,12"
                                        Orientation="Horizontal"
                                        Spacing="16">
                                <SymbolIcon Symbol="Globe" />
                                <TextBlock>
                                    <!--  不知道为什么要空一格才能和下行文字对齐  -->
                                    <Run Text="网页小工具" /><LineBreak /><Run FontSize="12"
                                         Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                         Text="在左侧导航栏中添加网页小工具" />
                                </TextBlock>
                            </StackPanel>
                        </Expander.Header>
                        <Expander.Content>
                            <Grid RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <CommandBar DefaultLabelPosition="Right">
                                    <CommandBar.Content>
                                        <TextBlock Margin="12,14,0,0"
                                                   FontWeight="Bold"
                                                   Text="已添加的网页小工具" />
                                    </CommandBar.Content>
                                    <AppBarButton Command="{x:Bind vm.AddWebToolItemCommand, Mode=OneTime}"
                                                  Icon="Add"
                                                  Label="添加" />
                                    <AppBarButton Command="{x:Bind vm.DeleteSelectedWebToolItemCommand, Mode=OneTime}"
                                                  Icon="Delete"
                                                  Label="删除" />
                                    <AppBarButton Command="{x:Bind vm.SaveWebToolItemCommand, Mode=OneTime}"
                                                  Icon="Save"
                                                  Label="保存" />
                                </CommandBar>
                                <!--  网页小工具  -->
                                <ListView Grid.Row="1"
                                          AllowDrop="True"
                                          CanDragItems="True"
                                          CanReorderItems="True"
                                          ItemsSource="{Binding WebToolItemList, Mode=TwoWay}"
                                          SelectedItem="{x:Bind vm.SelectedWebToolItem, Mode=TwoWay}"
                                          SelectionMode="Single">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:WebToolItem">
                                            <Grid Margin="0,0,16,0"
                                                  HorizontalAlignment="Stretch"
                                                  ColumnSpacing="16">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="40" />
                                                    <ColumnDefinition Width="*"
                                                                      MinWidth="80"
                                                                      MaxWidth="160" />
                                                    <ColumnDefinition Width="4*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <cc:ImageEx Grid.Column="0"
                                                            Width="24"
                                                            Source="{x:Bind Icon}"
                                                            Stretch="Uniform" />
                                                <TextBlock Grid.Column="1"
                                                           VerticalAlignment="Center"
                                                           Text="{x:Bind Title}" />
                                                <TextBlock Grid.Column="2"
                                                           VerticalAlignment="Center"
                                                           Text="{x:Bind Url}" />
                                                <TextBlock Grid.Column="3"
                                                           VerticalAlignment="Center"
                                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                           Text="&#xE700;" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </Expander.Content>
                    </Expander>

                    <!--  后台任务  -->
                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="后台任务" />
                    <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                        <Expander.Header>
                            <Grid>
                                <StackPanel Padding="0,12,0,12"
                                            Orientation="Horizontal"
                                            Spacing="16">
                                    <SymbolIcon Symbol="Clock" />
                                    <TextBlock Grid.Column="1" VerticalAlignment="Center">
                                        <Run Text="实时便笺定时刷新及提醒通知" />
                                        <LineBreak />
                                        <Run FontSize="12"
                                             Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                             Text="每16分钟刷新一次实时便笺磁贴" />
                                    </TextBlock>
                                </StackPanel>
                                <ToggleSwitch Margin="0,0,-44,0"
                                              HorizontalAlignment="Right"
                                              IsOn="{x:Bind vm.IsRegisterDailyNoteTask, Mode=TwoWay}"
                                              OffContent="已停止"
                                              OnContent="已启用" />
                            </Grid>
                        </Expander.Header>
                        <Expander.Content>
                            <StackPanel Margin="0,-16,44,-16">
                                <Grid>
                                    <StackPanel Padding="0,12,0,12"
                                                HorizontalAlignment="Left"
                                                Orientation="Horizontal"
                                                Spacing="16">
                                        <Border Width="20" />
                                        <TextBlock>
                                            <Run Text="提醒通知" />
                                            <LineBreak />
                                            <Run FontSize="12"
                                                 Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                                 Text="原粹树脂或洞天宝钱超过阈值时，使用系统通知提醒您" />
                                        </TextBlock>
                                    </StackPanel>
                                    <ToggleSwitch Margin="0,0,-44,0"
                                                  HorizontalAlignment="Right"
                                                  VerticalAlignment="Center"
                                                  IsOn="{x:Bind vm.EnableDailyNoteNotification, Mode=TwoWay}"
                                                  OffContent="已停止"
                                                  OnContent="已启用" />
                                </Grid>
                                <MenuFlyoutSeparator />
                                <Grid>
                                    <StackPanel Padding="0,12,0,12"
                                                HorizontalAlignment="Left"
                                                Orientation="Horizontal"
                                                Spacing="16">
                                        <Border Width="20" />
                                        <TextBlock>
                                            <Run Text="原粹树脂提醒阈值" />
                                            <LineBreak />
                                            <Run FontSize="12"
                                                 Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                                 Text="原粹树脂达到此值，且上一次刷新时未达到时，发送系统通知" />
                                        </TextBlock>
                                    </StackPanel>
                                    <NumberBox Width="120"
                                               HorizontalAlignment="Right"
                                               VerticalAlignment="Center"
                                               SmallChange="10"
                                               SpinButtonPlacementMode="Compact"
                                               Value="{x:Bind vm.DailyNoteNotification_ResinThreshold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </Grid>
                                <Grid>
                                    <StackPanel Padding="0,12,0,12"
                                                HorizontalAlignment="Left"
                                                Orientation="Horizontal"
                                                Spacing="16">
                                        <Border Width="20" />
                                        <TextBlock>
                                            <Run Text="洞天宝钱提醒阈值" />
                                            <LineBreak />
                                            <Run FontSize="12"
                                                 Foreground="{StaticResource TextFillColorSecondaryBrush}"
                                                 Text="通天宝钱使用相对阈值" />
                                        </TextBlock>
                                    </StackPanel>
                                    <NumberBox Name="_NumberBox_HomeCoinThreshold"
                                               Width="120"
                                               HorizontalAlignment="Right"
                                               VerticalAlignment="Center"
                                               SmallChange="0.05"
                                               SpinButtonPlacementMode="Compact"
                                               Value="{x:Bind vm.DailyNoteNotification_HomeCoinThreshold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </Grid>
                            </StackPanel>
                        </Expander.Content>
                    </Expander>


                    <!--  临时功能  -->
                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="临时功能" />
                    <TextBlock FontSize="12"
                               Foreground="{StaticResource TextFillColorSecondaryBrush}"
                               Text="点击下面的按钮可以把相关信息保存到本地，供以后分析使用" />
                    <Button Command="{x:Bind vm.GetTravelRecordSummaryCommand, Mode=OneTime}" Content="获取旅行札记" />
                    <Button Command="{x:Bind vm.GetSpiralAbyssInfoSummaryCommand, Mode=OneTime}" Content="获取深渊记录" />
                    <TextBlock FontSize="12"
                               Foreground="{StaticResource TextFillColorSecondaryBrush}"
                               Text="切换背景图和保存到本地（随机的哦" />
                    <Button Command="{x:Bind vm.ChangeAppBackgroundWallpaperCommand, Mode=OneTime}" Content="切换背景图" />
                    <Button Command="{x:Bind vm.SaveBackgroundWallpaperCommand, Mode=OneTime}" Content="保存到本地" />
                </StackPanel>



            </Grid>


        </ScrollViewer>


        <!--  网页小工具编辑面板  -->
        <Grid Name="_Grid_EditWebToolItem"
              Grid.RowSpan="2"
              Grid.Column="2"
              Width="400"
              Padding="12,0,12,0"
              HorizontalAlignment="Right"
              Background="{StaticResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{StaticResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="4,0,0,4"
              RowSpacing="12"
              Visibility="{x:Bind vm.SelectedWebToolItem, Converter={StaticResource ObjectToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <AppBarButton Width="40"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Top"
                          Command="{x:Bind vm.CloseEditWebToolGridCommand, Mode=OneTime}"
                          Icon="Clear"
                          LabelPosition="Collapsed" />
            <StackPanel Grid.Row="1" Spacing="12">
                <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="基础设置" />
                <TextBlock Text="标题" />
                <TextBox IsSpellCheckEnabled="False"
                         PlaceholderText="不要太长"
                         Text="{x:Bind vm.SelectedWebToolItem.Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock Text="图标" />
                <TextBox IsSpellCheckEnabled="False"
                         PlaceholderText="图标的网址"
                         Text="{x:Bind vm.SelectedWebToolItem.Icon, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock Text="网址" />
                <TextBox IsSpellCheckEnabled="False"
                         PlaceholderText="优先填这个，然后点下面的按键"
                         Text="{x:Bind vm.SelectedWebToolItem.Url, Mode=TwoWay}" />
                <Button Command="{x:Bind vm.GetTitleAndIconByUrlCommand}" Content="获取标题和图标" />
                <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="高级设置" />
                <TextBlock Text="JavaScript" />
                <TextBox MaxHeight="300"
                         AcceptsReturn="True"
                         IsSpellCheckEnabled="False"
                         PlaceholderText="网页加载完成时会运行此脚本"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         Text="{x:Bind vm.SelectedWebToolItem.JavaScript, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap" />
            </StackPanel>


        </Grid>


    </Grid>
</Page>
